var $jsmvc$;if(!$jsmvc$){$jsmvc$={}};if(!$jsmvc$.core){$jsmvc$.core={}};
$jsmvc$.core.FacadeAbs=function(template){var self=this;var model={},page={},contro={};var observer={};var noticeID=0;var errMsg={"err1":"Can't find JS class # ","err2":"Can't find HTML template # ","err3":"Error:Loop extends # "}
var createExtends=function(classFunc,className,type,chain,topClassName){chain[className]=true;var abs,absP,absM,absC,obj,retProt,getProt;absP=$jsmvc$.core.PageAbs;absM=$jsmvc$.core.ModelAbs;absC=$jsmvc$.core.ControAbs;switch(type){case"page":abs=absP;break;case"model":abs=absM;break;case"contro":abs=absC;break;}
if(classFunc.parentClass&&typeof classFunc.parentClass=="string"){var pClass=findClass(classFunc.parentClass);if(chain[classFunc.parentClass]){alert(errMsg.err3+classFunc.parentClass);throw errMsg.err3+classFunc.parentClass;}
getProt=createExtends(pClass,classFunc.parentClass,type,chain,topClassName);if(pClass===absP||pClass===absM||pClass===absC){obj=new pClass(topClassName);}else{pClass.prototype.constructor=pClass;obj=new pClass();}}else if(abs&&classFunc!==abs){obj=new abs(topClassName);}
if(!getProt){getProt={};}
if(obj){if(obj.onCreate&&typeof obj.onCreate=="function"){retProt=obj.onCreate(getProt);delete obj.onCreate;}
classFunc.prototype=obj;}
var nextProt={};for(var i in getProt){nextProt[i]=getProt[i];}
if(retProt&&typeof retProt=="object"){for(var i in retProt){nextProt[i]=retProt[i];}}
return nextProt;}
var inspectExtends=function(classFunc){if(classFunc.parentClass&&typeof classFunc.parentClass=="string"){inspectExtends(findClass(classFunc.parentClass))}}
var findClass=function(className){var classFunc;if(className&&typeof className=="string"){var routeList=className.split(".");var classFunc=window[routeList[0]];if(classFunc){for(var i=1;i<routeList.length;i++){classFunc=classFunc[routeList[i]];if(!classFunc){break;}}}}
if(!classFunc||typeof classFunc!="function"){alert(errMsg.err1+className);throw errMsg.err1+className;}
return classFunc;}
var getTemplate=function(templateName){if(!template||!template[templateName]){alert(errMsg.err2+templateName);throw errMsg.err2+templateName;}
return template[templateName];}
var attachNotice=function(evtName,cb){if(typeof cb!="function"&&typeof cb!="string"){return-1;}
if(!observer[evtName]){observer[evtName]={};}
observer[evtName][++noticeID]=cb;return noticeID;}
var removeNotice=function(evtName,evtId){if(observer[evtName]&&observer[evtName][evtId]){delete observer[evtName][evtId];return true;}
return false;}
$jsmvc$.core.PageAbs.prototype.getTemplate=getTemplate;$jsmvc$.core.PageAbs.prototype.attachNotice=attachNotice;$jsmvc$.core.PageAbs.prototype.removeNotice=removeNotice;var sendBroadcast=function(evtName,data){if(!observer[evtName]){return-1;}
var count=0;for(var i in observer[evtName]){var func=observer[evtName][i];if(typeof func=="function"){func(evtName,data);}else{newInstance(func,"contro",evtName,data);}
count++;}
return count;}
var reqModel=function(className){if(model[className]){return model[className];}
return model[className]=newInstance(className,"model");}
var reqPage=function(className){if(page[className]){return page[className];}
return page[className]=newInstance(className,"page");}
var reqContro=function(className,evtName){if(contro[className]){return;}
inspectExtends(findClass(className));contro[className]={evtName:evtName,evtId:attachNotice(evtName,className)};}
var delModel=function(className){findClass(className);var obj=model[className];if(obj){delete model[className];if(typeof obj.onDestroy=="function"){obj.onDestroy();}}}
var delPage=function(className){findClass(className);var obj=page[className];if(obj){delete page[className];if(typeof obj.onDestroy=="function"){obj.onDestroy();}}}
var delContro=function(className){findClass(className);if(contro[className]){removeNotice(contro[className].evtName,contro[className].evtId);delete contro[className];}}
var newInstance=function(className,type){var mClass=findClass(className);var getProt=createExtends(mClass,className,type?type:null,{},className);mClass.prototype.constructor=mClass;var obj=type=="contro"?new mClass(arguments[2],arguments[3]):new mClass();if(obj.onCreate&&typeof obj.onCreate=="function"){obj.onCreate(getProt);delete obj.onCreate;}
return obj;}
this.sendBroadcast=sendBroadcast;this.reqModel=reqModel;this.reqPage=reqPage;this.reqContro=reqContro;this.delModel=delModel;this.delPage=delPage;this.delContro=delContro;this.newInstance=newInstance;this.startup=function(){}
this.supers={reqModel:reqModel,reqPage:reqPage,reqContro:reqContro,delModel:delModel,delPage:delPage,delContro:delContro,newInstance:newInstance,sendBroadcast:sendBroadcast,startup:self.startup}}
$jsmvc$.core.ModelAbs=function(className){this.className=className;var data;var self=this;var setData=function(v){data=v;}
var getData=function(){return data;}
this.onCreate=function(parent){return{getData:getData,setData:setData};};this.onDestroy=function(){self.onDestroy=undefined;$jsmvc$.facade.delPage(className);};this.supers={onDestroy:self.onDestroy};}
$jsmvc$.core.PageAbs=function(className){this.className=className;var errMsg={"err1":"Stage must be '<HTML Element> or <JQuery Object>'","err2":"Display must be '<HTML Element> or <JQuery Object> or <HTML Template Route String>'"};var stage;var display;var self=this;var isJQuery=function(element){return window.jQuery&&element instanceof window.jQuery;}
var isElement=function(element){if(window.HTMLElement&&element instanceof window.HTMLElement){return true;}
if(window.Element&&element instanceof window.Element){return true;}
if(window.jQuery&&element instanceof window.jQuery){return true;}
if(!window.Element){try{element.removeChild(element.appendChild(document.createElement("TEST")));return element.nodeType===1;}catch(e){return false;}}
return false;}
var isActive=function(matchStage){if(isElement(display)){var active=isJQuery(display)?(display.parent().length?true:false):(display.parentNode?true:false);if(active&&matchStage){if(!stage){return false;}
if(isJQuery(stage)){if(isJQuery(display)){if($.contains(stage.get(stage.length-1),display.get(0))){return active;}}else if($.contains(stage.get(stage.length-1),display)){return active;}}else{if(isJQuery(display)){if(display.parent().get(0)===stage){return active;}}else if(display.parentNode===stage){return active;}}
return false;}
return active;}else{return false;}}
var setStage=function(element){if(!isElement(element)){alert(errMsg.err1);throw errMsg.err1;}
if(stage&&stage===element){return element;}
return stage=element;}
var getStage=function(){return stage;}
var delStage=function(){if(stage){if(isActive(true)){isJQuery(display)?display.remove():display.parentNode.removeChild(display);}
stage=undefined;return true;}
return false;}
var setDisplay=function(element){if(!element||(typeof element!="string")&&!isElement(element)){alert(errMsg.err2);throw errMsg.err2;}
if(display&&element===display){return element;}
var oldElement;if(isActive(false)){oldElement=display;}
if(typeof element!="string"){display=element;}else{var tpl=getTemplate(element);display=document.createElement("DIV");display.innerHTML=tpl.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");if(display.childNodes.length==1){display=display.childNodes[0];}}
if(oldElement){if(isJQuery(oldElement)){oldElement.after(display);oldElement.remove();}else{if(isJQuery(display)){display.insertAfter(oldElement);}else{oldElement.parentNode.insertBefore(display,oldElement);}
oldElement.parentNode.removeChild(oldElement);}}
return display;}
var getDisplay=function(){return display;}
var delDisplay=function(){if(display){if(isActive(false)){isJQuery(display)?display.remove():display.parentNode.removeChild(display);}
display=undefined;return true;}
return false}
var getTemplate=this.getTemplate;delete this.getTemplate;var attachNotice=this.attachNotice;delete this.attachNotice;var removeNotice=this.removeNotice;delete this.removeNotice;this.showPage=function(){if(!stage||!display||isActive(true)){return false;}
if(isJQuery(stage)){stage.children().detach();stage.append(display);}else{while(stage.hasChildNodes())
{stage.removeChild(stage.firstChild);}
if(isJQuery(display)){for(var i=0;i<display.length;i++){stage.appendChild(display.get(i))}}else{stage.appendChild(display);}}
return true;};this.isActive=isActive;this.onCreate=function(parent){return{setStage:setStage,getStage:getStage,delStage:delStage,setDisplay:setDisplay,getDisplay:getDisplay,delDisplay:delDisplay,getTemplate:getTemplate,attachNotice:attachNotice,removeNotice:removeNotice};};this.onDestroy=function(){self.onDestroy=undefined;$jsmvc$.facade.delPage(className);delDisplay();};this.supers={showPage:self.showPage,isActive:self.isActive,onDestroy:self.onDestroy};}