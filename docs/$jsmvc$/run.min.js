
window["$jsmvc$"]={run:new function(){var ver="0_0_0";var oHead;var timeoutLoad;var oldBody=null;var self=this;var init=false;var ing=["&nbsp;&nbsp;&nbsp;",".&nbsp;&nbsp;","..&nbsp;","..."],ingIndex=0,timeIng;var totalLen=0,progressLen=0,currUrl={};var loadRecord={ext:{},css:{},js:{},html:{url:{},name:{}}};var facade=null;var errMsg={"err1":"Repeat add facade class!","err2":"Your not add facade class!","err3":"run.start function Can only call once!","err4":"run.start(parameter error)!","err5":"Can't find HEAD!","err6":"Browser version is too low!","err7":"run.includeExt format definition error # ","err8":"Frame core load not complete!","err9":"Load unusual!"}
var isIE=false,ieVer=9;if(navigator.appName=="Microsoft Internet Explorer")
{var iev=navigator.appVersion.split(";")[1].replace(/[ ]/g,"");switch(iev){case"MSIE4.0":case"MSIE5.0":case"MSIE5.5":ieVer=5;break;case"MSIE6.0":ieVer=6;break;case"MSIE7.0":ieVer=7;break;case"MSIE8.0":ieVer=8;break;}
isIE=true;}
var locParts=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/.exec(location.href.toLowerCase())||[];var isLocal=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(locParts[1]);Function.prototype["extends"]=function(classRoute){this.parentClass=classRoute;return this;};var createDisplay=function(){if(oldBody===null){oldBody=document.body.innerHTML;}
var num=Math.round(progressLen/totalLen*10);var ok="";var no="";for(var i=0;i<num;i++){ok+="■";}
for(var i=0;i<10-num;i++){no+="■";}
var gif="<div style='font:26px \"Arial\'><span style='color: #1c1c1c;'>"+ok+"</span><span style='color: #7f8171;'>"+no+"</span></div>";var txt="<div style='font:18px/25px \"Arial\";color: #7b755a;' id='msg'><span>loading</span><span id='ing'>"+ing[ingIndex]+"</span>"+(num*10)+"%</div>";var body="<div style='height:50px; width:160px;top:50%;left:50%;position:absolute;margin:-25px 0 0 -80px;'>"+gif+txt+"</div>";document.body.innerHTML="<div style='background-color: #fcfbed; position:absolute;width: 100%;height: 100%;text-align: center;'>"+body+"</div>";if(!timeIng){timeIng=setInterval(function(){if(ingIndex>3){ingIndex=0;}
var ingSpan=document.getElementById("ing");if(ingSpan){ingSpan.innerHTML=ing[ingIndex];}else{clearTimeout(timeIng);timeIng=null;}
ingIndex++;},100);}}
var loading=function(total,progress){if(self.onLoading&&typeof self.onLoading=="function"){self.onLoading(total,progress);}else{createDisplay();}}
var loadFail=function(url){if(self.onLoadFail&&typeof self.onLoadFail=="function"){self.onLoadFail(url);}else{createDisplay();document.getElementById("msg").innerHTML="load error # <br> url:["+url+"]";}}
var loadTimeout=function(urlList){if(self.onLoadTimeout&&typeof self.onLoadTimeout=="function"){self.onLoadTimeout(urlList);}else{var errUrl="";for(var i in urlList){if(errUrl==""){errUrl+=i;}else{errUrl+=" \n "+i;}}
createDisplay();document.getElementById("msg").innerHTML="load timeout # <br> url:["+errUrl+"]";}}
var compatibility=function(){if(self.onCompatibility&&typeof self.onCompatibility=="function"){self.onCompatibility();}else{createDisplay();document.getElementById("msg").innerHTML="Must be IE"+((typeof self.setIEVerLimit!="number"||self.setIEVerLimit<6)?6:self.setIEVerLimit)+".0 Above Browser!";}}
var getRequest=function(){var request;if(isLocal||window.XMLHttpRequest===undefined){request=window.ActiveXObject!==undefined?new window.ActiveXObject("Microsoft.XMLHTTP"):undefined;}else{request=window.XMLHttpRequest!==undefined?new window.XMLHttpRequest():undefined;}
if(!request){alert(errMsg.err6);throw errMsg.err6;}
return request;}
var createNamespace=function(url){var namespace=url.split(".js")[0].split("/");var namespaceLs=[];for(var i=0;i<namespace.length-1;i++){if(namespace[i]!=""&&typeof namespace[i]=="string"){namespaceLs.push(namespace[i]);}}
if(namespaceLs.length>0){var route=window[namespaceLs[0]];if(!route){window[namespaceLs[0]]={};route=window[namespaceLs[0]];}
for(var i=1;i<namespaceLs.length;i++){if(!route[namespaceLs[i]]){route[namespaceLs[i]]={};}
route=route[namespaceLs[i]];}
return{package:route,className:namespace[namespace.length-1]};}}
var includeJS=function(url,cb){if(loadRecord.js[url]){if(cb&&typeof cb=="function")cb(true,createNamespace(url));return;}
var route=createNamespace(url);var oScript=document.createElement("script");oScript.type="text/javascript";oScript.charset="utf-8";if(isIE&&ieVer<9){var request=getRequest();request.open("GET",(url.indexOf("?")==-1)?(url+"?ver="+ver):url);request.onreadystatechange=function(){if(request.readyState==4){if(request.status==200||request.status==0){oScript.text=request.responseText;oHead.appendChild(oScript);loadRecord.js[url]=true;if(cb&&typeof cb=="function")cb(true,route);oHead.removeChild(oScript);}else{if(cb&&typeof cb=="function")cb(false,route);}}};request.send();}else{oScript.src=(url.indexOf("?")==-1)?(url+"?ver="+ver):url;oHead.appendChild(oScript);var funcEvent=function(status){oScript.onload=oScript.onerror=null;if(status)loadRecord.js[url]=true;if(cb&&typeof cb=="function")cb(status,route);oHead.removeChild(oScript);}
oScript.onerror=function(){funcEvent(false);}
oScript.onload=function(){funcEvent(true);};}}
var includeCSS=function(url,cb){if(loadRecord.css[url]){if(cb&&typeof cb=="function")cb(true);return;}
var oCss=document.createElement("link");oCss.rel="stylesheet";oCss.href=(url.indexOf("?")==-1)?(url+"?ver="+ver):url;oCss.charset="utf-8";oCss.type="text/css";var timer,sheet,cssRules;if("sheet"in oCss){sheet="sheet";cssRules="cssRules";}else{sheet="styleSheet";cssRules="rules";}
var funcEvent=function(status){clearInterval(timer);oCss.onerror=oCss.onload=null;if(status)loadRecord.css[url]=true;if(cb&&typeof cb=="function")cb(status);}
var funcState=function(){if(oCss[sheet]){try{oCss[sheet][cssRules].length;}catch(e){funcEvent(true);return;}
if(oCss[sheet][cssRules].length){funcEvent(true);}else{funcEvent(false);}}}
oCss.onerror=function(){funcEvent(false);}
oCss.onload=function(){funcState();}
timer=setInterval(funcState,50);oHead.appendChild(oCss);}
var includeHTML=function(url,cb){if(loadRecord.html.url[url]){if(cb&&typeof cb=="function")cb(true);return;}
var request=getRequest();request.open("GET",(url.indexOf("?")==-1)?(url+"?ver="+ver):url);request.onreadystatechange=function(){if(request.readyState==4){if(request.status==200||request.status==0){var templatePath=url.split(".html")[0].split("/");var templateName="";for(var i=0;i<templatePath.length;i++){templateName+=(templateName==""?"":".")+templatePath[i];}
var node=document.createElement("jsmvc");node.setAttribute("id",templateName);node.innerHTML=request.responseText;var childList=node.getElementsByTagName("jsmvc");if(childList.length){for(var j=0;j<childList.length;j++){var child=childList[j];loadRecord.html.url[url]=loadRecord.html.name[child.getAttribute("id")]=child.innerHTML;}}else{loadRecord.html.url[url]=loadRecord.html.name[templateName]=request.responseText;}
if(cb&&typeof cb=="function")cb(true);}else{if(cb&&typeof cb=="function")cb(false);}}};request.send();}
var includeExt=function(ext,cb){if(loadRecord.ext[ext]){if(typeof cb=="function"){cb(0);}
return;}
var total=0,progress=0,currExtUrl={};if(typeof cb=="function"){cb(1,{total:total,progress:progress});}
var timeout=setTimeout(function(){if(typeof cb=="function"){cb(3,currExtUrl);}},typeof self.setLoadTimeout=="number"?self.setLoadTimeout:60000);includeJS(ext,(function(url){return function(status,route){var fail=false;function failLoad(url){fail=true;clearTimeout(timeout);if(typeof cb=="function"){cb(2,url);}}
function errLoad(){clearTimeout(timeout);if(typeof cb=="function"){cb(4,errMsg.err7+ext);}}
if(!status){failLoad(url);return;}
var package=route?route.package[route.className]:undefined;if(!package){errLoad();return;}
var css=package.css;var js=package.js;var html=package.html;if((css&&typeof css!="object")||(js&&typeof js!="object")||(html&&typeof html!="object")){errLoad();return;}
total=(css?css.length:0)+(js?js.length:0)+(html?html.length:0);var ing=0;function completeLoad(){if(++ing<3){return;}
if(ing>3){alert(errMsg.err9);throw errMsg.err9;}
clearTimeout(timeout);loadRecord.ext[ext]=ext;if(typeof cb=="function"){cb(0);}}
var htmlNum=0;if(!html||html.length==0){completeLoad();}
for(var i=0;html&&i<html.length;i++){currExtUrl[html[i]]=html[i];includeHTML(html[i],(function(url){return function(status){if(!status||fail){if(!status){failLoad(url);}
return}
if(typeof cb=="function"){cb(1,{total:total,progress:++progress});}
delete currExtUrl[url];htmlNum++;if(htmlNum==html.length){completeLoad();}}})(html[i]));}
if(!js||js.length==0){completeLoad();}
var jsNum=0;for(var i=0;js&&i<js.length;i++){currExtUrl[js[i]]=js[i];includeJS(js[i],(function(url){return function(status){if(!status||fail){if(!status){failLoad(url);}
return;}
if(typeof cb=="function"){cb(1,{total:total,progress:++progress});}
delete currExtUrl[url];jsNum++;if(jsNum==js.length){completeLoad();}}})(js[i]));}
var cssNum=0;if(!css||css.length==0){completeLoad();}
for(var i=0;css&&i<css.length;i++){currExtUrl[css[i]]=css[i];includeCSS(css[i],(function(url){return function(status){if(!status||fail){if(!status){failLoad(url);}
return;}
if(typeof cb=="function"){cb(1,{total:total,progress:++progress});}
delete currExtUrl[url];cssNum++;if(cssNum==css.length){completeLoad();}}})(css[i]));}}})(ext),true);}
var start=function(css,js,html,ext,vers){if(isIE&&ieVer<((typeof self.setIEVerLimit!="number"||self.setIEVerLimit<6)?6:self.setIEVerLimit)){compatibility();return;}
if(init){alert(errMsg.err3);throw errMsg.err3;}
init=true;if((css&&typeof css!="object")||(js&&typeof js!="object")||(html&&typeof html!="object")||(ext&&typeof ext!="object")){alert(errMsg.err4);throw errMsg.err4;}
oHead=document.getElementsByTagName('HEAD');if(oHead){oHead=oHead.item(0);}else{alert(errMsg.err5);throw errMsg.err5;}
var fail=false;timeoutLoad=setTimeout(function(){loadTimeout(currUrl);},typeof self.setLoadTimeout=="number"?self.setLoadTimeout:60000);ver=vers?vers:ver;totalLen=(css?css.length:0)+(html?html.length:0)+(ext?ext.length:0);if(js){for(var i=0;i<js.length;i++){if(typeof js[i]!="object"){alert(errMsg.err4);throw errMsg.err4;}
totalLen+=js[i].length;}}
var ing=0;function completeLoad(){if(++ing<4){return;}
if(ing>4){alert(errMsg.err9);throw errMsg.err9;}
clearTimeout(timeoutLoad);clearTimeout(timeIng);if(oldBody!==null){document.body.innerHTML=oldBody;oldBody=null;}
if(!$jsmvc$.core.PageAbs||!$jsmvc$.core.ModelAbs||!$jsmvc$.core.FacadeAbs){alert(errMsg.err8);throw errMsg.err8;}
if(typeof facade=="function"){window["$jsmvc$"].facade=facade.prototype=new $jsmvc$.core.FacadeAbs(loadRecord.html.name);facade=new facade();window["$jsmvc$"].facade=facade;if(typeof facade.startup=="function"){facade.startup();delete facade.startup;}}else{alert(errMsg.err2);throw errMsg.err2;}}
function failLoad(url){fail=true;clearTimeout(timeoutLoad);clearTimeout(timeIng);loadFail(url);}
var extNum=0;if(!ext||ext.length==0){completeLoad();}
for(var i=0;ext&&i<ext.length;i++){currUrl[ext[i]]=ext[i];includeExt(ext[i],(function(url){return function(state,msg){if(state==2||fail){if(state==2){failLoad(msg);}
return;}
if(state==0){loading(totalLen,++progressLen);delete currUrl[url];extNum++;if(extNum==ext.length){completeLoad();}}else if(state==1){}else if(state==2){}else if(state==3){clearTimeout(timeoutLoad);loadTimeout(msg);}else if(state==4){alert(msg);throw msg;}}})(ext[i]));}
var htmlNum=0;if(!html||html.length==0){completeLoad();}
for(var i=0;html&&i<html.length;i++){currUrl[html[i]]=html[i];includeHTML(html[i],(function(url){return function(status){if(!status||fail){if(!status){failLoad(url);}
return;}
loading(totalLen,++progressLen);delete currUrl[url];htmlNum++;if(htmlNum==html.length){completeLoad();}}})(html[i]));}
if(!js||js.length==0){completeLoad();}else{var jsOffset=0;(function load(){var jsNum=0;if(js[jsOffset].length==0){jsOffset++;if(jsOffset==js.length){completeLoad();}else{load();}
return;}
var len=js[jsOffset].length;for(var i=0;i<len;i++){currUrl[js[i]]=js[i];includeJS(js[jsOffset][i],(function(url){return function(status){if(!status||fail){if(!status){failLoad(url);}
return;}
loading(totalLen,++progressLen);delete currUrl[url];jsNum++;if(jsNum==js[jsOffset].length){if(jsOffset+1==js.length){completeLoad();}else{jsOffset++;load();}}}})(js[jsOffset][i]));}})();}
var cssNum=0;if(!css||css.length==0){completeLoad();}
for(var i=0;css&&i<css.length;i++){currUrl[css[i]]=css[i];includeCSS(css[i],(function(url){return function(status){if(!status||fail){if(!status){failLoad(url);}
return;}
loading(totalLen,++progressLen);delete currUrl[url];cssNum++;if(cssNum==css.length){completeLoad();}}})(css[i]));}
loading(totalLen,progressLen);}
var addFacade=function(fo){if(facade){alert(errMsg.err1);throw errMsg.err1;}
facade=fo;}
this.start=start;this.includeJS=includeJS;this.includeCSS=includeCSS;this.includeHTML=includeHTML;this.includeExt=includeExt;this.addFacade=addFacade;this.onLoading=null;this.onLoadFail=null;this.onLoadTimeout=null;this.onCompatibility=null;this.setLoadTimeout=null;this.setIEVerLimit=null;}}